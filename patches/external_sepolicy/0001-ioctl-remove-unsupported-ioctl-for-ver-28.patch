From 8d9e754a41e10fcccf981aaf7eebcb85afb8171a Mon Sep 17 00:00:00 2001
From: rote66 <pontifex23872388@gmail.com>
Date: Tue, 28 Apr 2020 15:10:13 +0800
Subject: [PATCH] ioctl:remove unsupported ioctl for ver 28

Change-Id: Ib45b430c44700e147e872e1f7b2026c57f2a9924
---
 Android.mk       | 1 -
 domain.te        | 2 +-
 isolated_app.te  | 2 +-
 shell.te         | 2 +-
 untrusted_app.te | 2 +-
 5 files changed, 4 insertions(+), 5 deletions(-)

diff --git a/Android.mk b/Android.mk
index 1b903bd..f3da450 100644
--- a/Android.mk
+++ b/Android.mk
@@ -36,7 +36,6 @@ sepolicy_build_files := security_classes \
                         policy_capabilities \
                         te_macros \
                         attributes \
-                        ioctl_macros \
                         *.te \
                         roles \
                         users \
diff --git a/domain.te b/domain.te
index a188365..30044fe 100644
--- a/domain.te
+++ b/domain.te
@@ -35,7 +35,7 @@ allow domain self:lnk_file r_file_perms;
 allow domain self:{ fifo_file file } rw_file_perms;
 allow domain self:unix_dgram_socket { create_socket_perms sendto };
 allow domain self:unix_stream_socket { create_stream_socket_perms connectto };
-allow domain domain:{ unix_dgram_socket unix_stream_socket } unpriv_unix_sock_ioctls;
+#allow domain domain:{ unix_dgram_socket unix_stream_socket } unpriv_unix_sock_ioctls;
 
 # Inherit or receive open files from others.
 allow domain init:fd use;
diff --git a/isolated_app.te b/isolated_app.te
index 535e5de..025c2f7 100644
--- a/isolated_app.te
+++ b/isolated_app.te
@@ -19,7 +19,7 @@ allow isolated_app activity_service:service_manager find;
 allow isolated_app display_service:service_manager find;
 
 # only allow unprivileged socket ioctl commands
-allow isolated_app domain:{ rawip_socket tcp_socket udp_socket } unpriv_sock_ioctls;
+#allow isolated_app domain:{ rawip_socket tcp_socket udp_socket } unpriv_sock_ioctls;
 
 #####
 ##### Neverallow
diff --git a/shell.te b/shell.te
index 4b4093d..f4bbef6 100644
--- a/shell.te
+++ b/shell.te
@@ -78,7 +78,7 @@ allow shell bootchart_data_file:dir rw_dir_perms;
 allow shell bootchart_data_file:file create_file_perms;
 
 # only allow unprivileged socket ioctl commands
-allow shell self:{ rawip_socket tcp_socket udp_socket } unpriv_sock_ioctls;
+#allow shell self:{ rawip_socket tcp_socket udp_socket } unpriv_sock_ioctls;
 
 # Do not allow shell to hard link to any files.
 # In particular, if shell hard links to app data
diff --git a/untrusted_app.te b/untrusted_app.te
index a17943f..8b8aa8e 100644
--- a/untrusted_app.te
+++ b/untrusted_app.te
@@ -102,7 +102,7 @@ allow untrusted_app { apk_tmp_file apk_private_tmp_file }:dir r_dir_perms;
 allow untrusted_app { apk_tmp_file apk_private_tmp_file }:file r_file_perms;
 
 # only allow unprivileged socket ioctl commands
-allow untrusted_app domain:{ rawip_socket tcp_socket udp_socket } unpriv_sock_ioctls;
+#allow untrusted_app domain:{ rawip_socket tcp_socket udp_socket } unpriv_sock_ioctls;
 
 # Allow GMS core to access perfprofd output, which is stored
 # in /data/misc/perfprofd/. GMS core will need to list all
-- 
2.26.2

